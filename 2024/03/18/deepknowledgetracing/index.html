<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="DeepKnowledgeTracing, 记录记录">
    <meta name="description" content="My first project——DKT">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>DeepKnowledgeTracing | 记录记录</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 6.3.0"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">记录记录</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">记录记录</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/chris2ease/chris2ease.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/chris2ease/chris2ease.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('https://chris2ease-1324337338.cos.ap-shanghai.myqcloud.com/ioq.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">DeepKnowledgeTracing</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">
                                <span class="chip bg-color">人工智能</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/DeepLearning/" class="post-category">
                                DeepLearning
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2024-03-18
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="DeepKnowledgeTracing"><a href="#DeepKnowledgeTracing" class="headerlink" title="DeepKnowledgeTracing"></a>DeepKnowledgeTracing</h1><p><img src="https://chris2ease-1324337338.cos.ap-shanghai.myqcloud.com/DeepKnowledgeTracing/DKT.png" alt="Abstract"></p>
<p>DeepKnowledgeTracing（DKT）是一种基于深度学习的模型，用于对学生的知识掌握情况进行建模和预测，可以通过分析学生的历史答题记录来推断他们的知识水平和学习进度。</p>
<p>DKT的核心思想是利用递归神经网络（RNN）来捕捉学生的学习轨迹和知识状态的动态变化。模型接受学生的答题序列作为输入，并通过时间步的迭代来预测学生在下一个时间步的答题情况。通过不断地对学生的答题进行预测和比较，DKT可以逐渐调整模型的参数，提高对学生知识状态的准确预测能力。</p>
<p>DKT的关键创新是引入了一个称为”学生知识状态向量”的概念，它用于表示学生在不同知识点上的掌握程度。该向量通过RNN中的记忆单元来维护和更新，从而捕捉学生的知识状态随时间的变化。通过将学生的答题序列与学生知识状态向量进行联合建模，DKT可以更准确地推断学生在不同知识点上的知识水平。</p>
<p>使用DKT进行知识状态预测可以有助于教育领域的一些应用，例如个性化学习和智能辅导系统。通过对学生的知识状态进行建模和预测，教育者可以更好地了解学生的学习需求和困难，从而为他们提供个性化的学习支持和指导。</p>
<p><img src="https://chris2ease-1324337338.cos.ap-shanghai.myqcloud.com/DeepKnowledgeTracing/DKT1.png" alt="DKT优势"></p>
<p><strong>新型的RNN输入编码，表现遥遥领先，无需专家注释，生成定制题库</strong></p>
<p><img src="https://chris2ease-1324337338.cos.ap-shanghai.myqcloud.com/DeepKnowledgeTracing/DKT2.png" alt="DKT训练测试"></p>
<p>此模型的自我学习能力很强，可以根据做过的题目类型以及准确率来预测涉及某些知识点的答题情况，并不必需人工分类注释，很多功能类似的大模型在做数据分析时往往需要人工确定参数阈值，兼容性不够好。</p>
<p><img src="https://chris2ease-1324337338.cos.ap-shanghai.myqcloud.com/DeepKnowledgeTracing/DKT3.png" alt="RNN"></p>
<p><img src="https://chris2ease-1324337338.cos.ap-shanghai.myqcloud.com/DeepKnowledgeTracing/DKT6.png" alt="LSTM"></p>
<p>RNN的LSTM所提供的长期记忆功能是其重要优势</p>
<p><img src="https://chris2ease-1324337338.cos.ap-shanghai.myqcloud.com/DeepKnowledgeTracing/DKT4.png" alt="RNN工作基本原理"></p>
<p>在DeepKnowledgeTracing（DKT）模型中，one-hot编码用于表示学生的答题情况或知识点的状态。</p>
<p>在one-hot编码中，对于一个具有N个可能取值的离散变量，将其编码为一个长度为N的二进制向量。向量中只有一个元素为1，表示当前取值，而其他元素都为0。这样的编码方式能够将每个离散取值映射到一个唯一的向量表示。在DKT中，one-hot编码用于表示学生的答题情况。假设有M个不同的题目，每个题目都有可能的答案选项（如A、B、C、D等）。那么，每个题目的答题情况可以使用一个长度为M的one-hot向量来表示。向量中只有对应学生选择的答案选项为1，其他选项均为0。</p>
<p>类似地，DKT中的知识点状态也可以使用one-hot编码表示。如果有K个不同的知识点，那么每个知识点的状态可以使用一个长度为K的one-hot向量来表示。向量中只有对应知识点为当前学生所掌握的知识点时为1，其他知识点均为0。</p>
<p>通过使用one-hot编码，DKT模型能够将离散的答题情况或知识点状态转换为可供神经网络处理的向量表示形式。这样的表示方式使得模型能够更好地处理离散数据，并进行相应的预测和推断。</p>
<p><img src="https://chris2ease-1324337338.cos.ap-shanghai.myqcloud.com/DeepKnowledgeTracing/DKT7.png" alt="输入输出"></p>
<p><img src="https://chris2ease-1324337338.cos.ap-shanghai.myqcloud.com/DeepKnowledgeTracing/DKT9.png" alt="输入"></p>
<p><img src="/2024/03/18/deepknowledgetracing/DKT8.png" alt="输出"></p>
<p><img src="https://chris2ease-1324337338.cos.ap-shanghai.myqcloud.com/DeepKnowledgeTracing/DKT5.png" alt="DKT效果"></p>
<p>DKT需要大量答题数据，对于线上的大规模教学更有帮助。</p>
<p>DKT核心代码是三个文件:”deep_knowledge_tracing_model.py“,”data.py”,”main.py”.</p>
<h2 id="”deep-knowledge-tracing-model-py“"><a href="#”deep-knowledge-tracing-model-py“" class="headerlink" title="”deep_knowledge_tracing_model.py“"></a>”deep_knowledge_tracing_model.py“</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
    <span class="token comment"># 导入PyTorch中的神经网络模块</span>
<span class="token keyword">class</span> <span class="token class-name">DeepKnowledgeTracing</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Deep Knowledge tracing model"""</span>
    <span class="token comment">#定义了一个名为 DeepKnowledgeTracing 的类，它是 nn.Module 的子类，因此表示这是一个 PyTorch 模型。</span>
    <span class="token comment"># 构造方法 tie_weights是参数共享的意思</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> rnn_type<span class="token punctuation">,</span> input_size<span class="token punctuation">,</span> hidden_size<span class="token punctuation">,</span> num_skills<span class="token punctuation">,</span> nlayers<span class="token punctuation">,</span> dropout<span class="token operator">=</span><span class="token number">0.6</span><span class="token punctuation">,</span> tie_weights<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#以上是参数名，实际上的self的基本成员变量是rnn_type,nhid,nlayers,其他的是自定义初始化的参数</span>
        <span class="token comment"># 重构8个字典属性</span>
        <span class="token comment">#这是类的构造方法。它接受一些参数，包括循环神经网络的类型（rnn_type）、输入的大小（input_size）、隐藏层的大小（hidden_size）、技能数量（num_skills）、层数（nlayers）等。还有一些可选参数，如丢弃率（dropout）和是否共享参数权重（tie_weights）。</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>DeepKnowledgeTracing<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#调用父类 nn.Module 的构造方法，确保正确地初始化模型。</span>
        <span class="token keyword">if</span> rnn_type <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'LSTM'</span><span class="token punctuation">,</span> <span class="token string">'GRU'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token comment"># 让rnn模型为LSTM或者GRU，后使用getattr函数取出对应模型的实例</span>
            self<span class="token punctuation">.</span>rnn <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>nn<span class="token punctuation">,</span> rnn_type<span class="token punctuation">)</span><span class="token punctuation">(</span>input_size<span class="token punctuation">,</span> hidden_size<span class="token punctuation">,</span> nlayers<span class="token punctuation">,</span> batch_first<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> dropout<span class="token operator">=</span>dropout<span class="token punctuation">)</span>
            <span class="token comment">#创建 RNN 模型，并根据给定的参数初始化。</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                nonlinearity <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'RNN_TANH'</span><span class="token punctuation">:</span> <span class="token string">'tanh'</span><span class="token punctuation">,</span> <span class="token string">'RNN_RELU'</span><span class="token punctuation">:</span> <span class="token string">'relu'</span><span class="token punctuation">&#125;</span><span class="token punctuation">[</span>rnn_type<span class="token punctuation">]</span>
            <span class="token keyword">except</span> KeyError<span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""An invalid option for `--model` was supplied,
                                     options are ['LSTM', 'GRU', 'RNN_TANH' or 'RNN_RELU']"""</span><span class="token punctuation">)</span>
                <span class="token comment">#类型不匹配报错</span>
            self<span class="token punctuation">.</span>rnn <span class="token operator">=</span> nn<span class="token punctuation">.</span>RNN<span class="token punctuation">(</span>input_size<span class="token punctuation">,</span> hidden_size<span class="token punctuation">,</span> nlayers<span class="token punctuation">,</span> nonlinearity<span class="token operator">=</span>nonlinearity<span class="token punctuation">,</span> dropout<span class="token operator">=</span>dropout<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>decoder <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_size<span class="token punctuation">,</span> num_skills<span class="token punctuation">)</span>
        <span class="token comment">#Decoder 是一个重要的组件，用于生成目标序列或标签。最简单的 Decoder 可能是一个基于循环神经网络（Recurrent Neural Network，RNN）的 Decoder。在这种情况下，Decoder 将上一个时间步的输出作为当前时间步的输入，并依次生成序列。常见的 RNN Decoder 包括基本的 RNN、长短期记忆网络（Long Short-Term Memory，LSTM）和门控循环单元（Gated Recurrent Unit，GRU）等。</span>
        <span class="token comment">#创建一个线性层作为解码器，将 RNN 的隐藏状态映射到技能数量上。</span>
        <span class="token comment"># input维度是(seq_size, batch_size, input_size)</span>
        <span class="token comment"># h0（初始隐藏状态）维度是(numLayers, batch_size, hidden_size)numLayers 表示 RNN 模型中的层数，即神经网络中堆叠的 RNN 层的数量。batch_size 表示每个时间步输入的样本数。hidden_size 表示每个隐藏层中的隐藏单元数。</span>
        <span class="token comment"># 成员变量的初始化</span>
        self<span class="token punctuation">.</span>init_weights<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>rnn_type <span class="token operator">=</span> rnn_type
        self<span class="token punctuation">.</span>nhid <span class="token operator">=</span> hidden_size
        self<span class="token punctuation">.</span>nlayers <span class="token operator">=</span> nlayers
        
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> inputs<span class="token punctuation">,</span> hidden<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 这里提示函数名与内置函数名一样</span>
        <span class="token comment"># 定义了模型的前向传播方法。接受输入 inputs 和隐藏状态 hidden，然后通过 RNN 模型和线性解码器进行计算，返回预测的技能掌握程度 decoded 和更新后的隐藏状态 hidden。</span>
        <span class="token comment"># input = self.drop(input)</span>
        output<span class="token punctuation">,</span> hidden <span class="token operator">=</span> self<span class="token punctuation">.</span>rnn<span class="token punctuation">(</span>inputs<span class="token punctuation">,</span> hidden<span class="token punctuation">)</span><span class="token comment">#RNN模型计算</span>
        <span class="token comment"># output表示 RNN 模型的输出，它是一个张量（是向量的推广，它可以有多个维度，并且每个维度可以有多个分量），维度(seq_size, batch_size, hidden_size)</span>
        <span class="token comment">#seq_size 表示序列的长度，即 RNN 模型处理的时间步数。batch_size 表示每个时间步输入的样本数。hidden_size 表示每个隐藏层中的隐藏单元数。</span>
        <span class="token comment"># hidden维度(numLayers, batch_size, hidden_size)</span>
        <span class="token comment"># 表示 RNN 模型在最后一个时间步的隐藏状态，它也是一个元组，其中包含两个张量：第一个张量的维度为 (numLayers, batch_size, hidden_size)，表示最后一个时间步的隐藏层状态。第二个张量的维度与第一个张量相同，如果使用的是 LSTM，则表示最后一个时间步的细胞状态；如果使用的是其他类型的 RNN（如 GRU），则为 None。</span>
        <span class="token comment"># output = self.drop(output)</span>
       
        decoded <span class="token operator">=</span> self<span class="token punctuation">.</span>decoder<span class="token punctuation">(</span>output<span class="token punctuation">.</span>contiguous<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span>output<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">*</span> output<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> output<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 这一步是通过线性层 self.decoder 对二维张量进行解码操作，得到模型的预测结果 decoded。线性层是一种全连接层，它将输入张量进行线性变换，并将其映射到指定维度的输出空间。在这里，self.decoder 的输入是形状变换后的二维张量，它将其映射到维度为 num_skills 的输出空间，即模型需要预测的技能数量。</span>
        <span class="token comment"># 全连接层（Fully Connected Layer），也称为密集连接层或仿射层，是神经网络中常用的一种基本层类型。在全连接层中，每个输入神经元都与输出神经元相连接，即每个输入神经元都与每个输出神经元相连，形成完全连接的网络结构。这意味着全连接层中的每个输出值都是由输入值的线性组合和激活函数的非线性变换得到的。</span>
       <span class="token comment"># 全连接层的作用是学习输入数据的特征表示，并将这些特征表示映射到输出空间，通常用于实现从低级特征到高级特征的变换。在深度学习模型中，全连接层通常用于模型的最后几层，用于将抽取的特征表示映射到模型输出（例如分类标签或回归值）。</span>
       <span class="token comment"># 与全连接层相对应的是局部连接层或者卷积层（Convolutional Layer），它们是另一种常见的神经网络层类型。在卷积层中，神经元只与输入数据的局部区域连接，而不是与整个输入数据连接。卷积层在处理二维图像数据时，可以有效地提取局部区域之间的特征关系。卷积层使用一组称为卷积核（或滤波器）的小窗口，通过在输入图像上滑动这些卷积核，并在每个位置上进行卷积操作，从而计算输出特征图。在卷积操作中，卷积核与输入图像的局部区域进行点乘，然后将结果相加，最终生成输出特征图中的一个单个像素值。这种局部连接的特性使得卷积层能够有效地捕获输入数据中的空间结构信息，因此在处理图像等二维数据时非常有效。在许多视觉任务中，卷积层通常被用于提取图像的特征表示。</span>
        <span class="token comment">#在典型的循环神经网络（RNN）架构中，并没有卷积层，而是由循环层组成，如循环神经网络单元（如LSTM、GRU等）或者简单的循环神经网络。这是因为 RNN 主要用于处理序列数据，而不是像图像处理等空间结构数据，因此通常不需要卷积层来提取空间特征。循环神经网络通过在时间步上传递隐藏状态来处理序列数据。在处理每个时间步的输入时，RNN会根据当前时间步的输入和前一个时间步的隐藏状态生成当前时间步的隐藏状态。这样，RNN 可以对序列数据的时间依赖关系进行建模。</span>
        <span class="token comment"># contiguous()一般都会和view()搭配在一起使用，view的使用要求空间连续，相当于tensorflow（类似PyTorch的深度学习框架）中的reshape，这一步是为了确保张量 output 是连续的内存布局。在 PyTorch 中，有些操作会导致输出张量的内存布局不连续，而连续的内存布局对于某些操作（例如 view 操作）是必要的。因此，通过 contiguous() 操作可以确保 output 张量的内存布局是连续的。</span>
        <span class="token comment">#.view(output.size(0) * output.size(1), output.size(2))：这一步是将 output 张量进行形状变换，将其转换为二维张量。具体来说，它将 output 张量的前两个维度（seq_size 和 batch_size）合并成一个维度，并保留第三个维度（hidden_size）。这样做的目的是将 RNN 模型的输出转换为线性层的输入形状，以便进行解码操作。</span>
       
        <span class="token comment"># 假设output是2*3*3的，则view的2个参数值分别为2*3，3</span>
        <span class="token comment"># 将output的最后一个维度hidden_size变为num_skills</span>
        <span class="token keyword">return</span> decoded<span class="token punctuation">,</span> hidden

    <span class="token comment"># 这里只初始化了每个cell中的h和c</span>
    <span class="token comment"># 在 LSTM 中，细胞状态（cell state）是一个独立于隐藏状态（hidden state）的状态，用于在不同时间步之间传递和保存信息。细胞状态会根据门控单元（遗忘门、输入门、输出门）的控制来更新，门控单元的作用是调节细胞状态的流动，从而有效地捕捉长期依赖关系。而在门控循环单元（GRU）中，虽然没有显式的细胞状态（cell state），但是在GRU中仍然存在一个称为“隐状态”的状态，用于保存模型在当前时间步的信息。</span>
    <span class="token keyword">def</span> <span class="token function">init_hidden</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> bsz<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 初始化隐藏状态的方法，根据指定的批大小 bsz 返回对应形状的零张量，用于 RNN 模型的初始隐藏状态。</span>
        <span class="token comment"># 每一隐层参数</span>
        weight <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 如果是LSTM的话还需要c</span>
        <span class="token comment"># 在门控循环单元（GRU）中，相对于长短期记忆网络（LSTM），没有显式的细胞状态（cell state，通常记为c）。GRU 的设计旨在减少参数数量，简化网络结构，同时保持对长期依赖关系的建模能力。</span>
        <span class="token comment"># 在 GRU 中，隐藏状态（hidden state，通常记为h）不仅充当了记忆单元的角色，还负责传递和保存信息。相比于 LSTM，GRU 只有两个门控单元：重置门（reset gate）和更新门（update gate）。这两个门控单元控制着隐藏状态的更新和重置操作，从而实现对序列数据的建模。</span>
        <span class="token comment"># 重置门用于控制是否应该忽略先前的隐藏状态，而更新门则用于控制新的隐藏状态应该多大程度上保留先前的隐藏状态。这种设计使得 GRU 具有较少的参数量和计算复杂度，同时仍然能够有效地捕捉长期依赖关系。</span>
        <span class="token comment"># 因此，相对于 LSTM，GRU 在结构上更加简洁，不需要显式的细胞状态（c），而是仅仅依赖于隐藏状态（h）来传递和保存信息，从而在一定程度上减少了网络的复杂性。</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>rnn_type <span class="token operator">==</span> <span class="token string">'LSTM'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>weight<span class="token punctuation">.</span>new_zeros<span class="token punctuation">(</span>self<span class="token punctuation">.</span>nlayers<span class="token punctuation">,</span> bsz<span class="token punctuation">,</span> self<span class="token punctuation">.</span>nhid<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    weight<span class="token punctuation">.</span>new_zeros<span class="token punctuation">(</span>self<span class="token punctuation">.</span>nlayers<span class="token punctuation">,</span> bsz<span class="token punctuation">,</span> self<span class="token punctuation">.</span>nhid<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> weight<span class="token punctuation">.</span>new_zeros<span class="token punctuation">(</span>self<span class="token punctuation">.</span>nlayers<span class="token punctuation">,</span> bsz<span class="token punctuation">,</span> self<span class="token punctuation">.</span>nhid<span class="token punctuation">)</span>

    <span class="token comment"># 这里只初始化了线性层decoder的参数</span>
    <span class="token comment"># 初始化模型参数的方法。这里对解码器的权重进行了均匀分布初始化，并将偏置初始化为零。</span>
    <span class="token keyword">def</span> <span class="token function">init_weights</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        initrange <span class="token operator">=</span> <span class="token number">0.05</span>
        self<span class="token punctuation">.</span>decoder<span class="token punctuation">.</span>bias<span class="token punctuation">.</span>data<span class="token punctuation">.</span>zero_<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>decoder<span class="token punctuation">.</span>weight<span class="token punctuation">.</span>data<span class="token punctuation">.</span>uniform_<span class="token punctuation">(</span><span class="token operator">-</span>initrange<span class="token punctuation">,</span> initrange<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="“data-py”"><a href="#“data-py”" class="headerlink" title="“data.py”"></a>“data.py”</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> csv 
<span class="token comment"># 导入 CSV 模块，用于读取 CSV 文件。</span>
<span class="token keyword">import</span> random
<span class="token comment"># 导入 random 模块，用于打乱数据。</span>
<span class="token keyword">import</span> sys
<span class="token comment"># 导入sys模块，用于输出信息到标准错误流</span>

<span class="token keyword">def</span> <span class="token function">load_data</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 提示参数都要小写</span>
    rows <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment"># row用于储存读取的csv文件的每一行数据</span>
    max_skill_num <span class="token operator">=</span> <span class="token number">0</span>
    max_num_problems <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment"># 将数据集存储到列表中</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> csvfile<span class="token punctuation">:</span>
        reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>csvfile<span class="token punctuation">,</span> delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>
            rows<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">)</span>
    index <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"the number of rows is "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>rows<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span>
    tuple_rows <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment"># 用于储存转换后的数据，每三行数据组成一个三元组</span>
    <span class="token comment"># turn list to tuple 每3个row作为1个tuple</span>
    <span class="token keyword">while</span> index <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>rows<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
        problems_num <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>rows<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token comment"># 得到问题数量，及每个tuple的第一行的数字</span>
        <span class="token comment"># 找出每个tuple第2行的最大数值作为最大技能编号</span>
        tmp_max_skill <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> rows<span class="token punctuation">[</span>index<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> tmp_max_skill <span class="token operator">></span> max_skill_num<span class="token punctuation">:</span>
            max_skill_num <span class="token operator">=</span> tmp_max_skill
        <span class="token comment"># 去除问题回答数量小于2的学生数据</span>
        <span class="token keyword">if</span> problems_num <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">:</span>
            index <span class="token operator">+=</span> <span class="token number">3</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 找出所有学生回答问题数量的最大值</span>
            <span class="token comment"># 通过找到所有学生回答问题数量的最大值，可以将所有学生的序列数据（如问题答题情况）进行统一长度的填充或截断，以便输入到模型中进行训练或测试。这样做的好处是保持数据的一致性，并且能够更有效地利用计算资源和模型训练速度。</span>
            <span class="token keyword">if</span> problems_num <span class="token operator">></span> max_num_problems<span class="token punctuation">:</span>
                max_num_problems <span class="token operator">=</span> problems_num
            <span class="token comment"># tup即每个学生的三元组</span>
            tup <span class="token operator">=</span> <span class="token punctuation">(</span>rows<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span> rows<span class="token punctuation">[</span>index<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rows<span class="token punctuation">[</span>index<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token comment"># tuple_rows即所有学生的三元组</span>
            tuple_rows<span class="token punctuation">.</span>append<span class="token punctuation">(</span>tup<span class="token punctuation">)</span>
            index <span class="token operator">+=</span> <span class="token number">3</span>
    <span class="token comment"># shuffle the tuple</span>
    random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>tuple_rows<span class="token punctuation">)</span>  <span class="token comment"># 打乱原元祖的顺序</span>
    <span class="token comment"># 也就是输出过滤后的学生数量</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The number of students is "</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>tuple_rows<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Finish reading data"</span><span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span>
    <span class="token comment"># 技能编号从0开始 故返回技能个数需要+1</span>
    <span class="token keyword">return</span> tuple_rows<span class="token punctuation">,</span> max_num_problems<span class="token punctuation">,</span> max_skill_num<span class="token operator">+</span><span class="token number">1</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="”main-py“"><a href="#”main-py“" class="headerlink" title="”main.py“"></a>”main.py“</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> argparse
<span class="token comment"># 解析命令行参数</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> time
<span class="token comment"># 用于计时</span>
<span class="token keyword">from</span> data <span class="token keyword">import</span> load_data
<span class="token keyword">from</span> deep_knowledge_tracing_model <span class="token keyword">import</span> DeepKnowledgeTracing

<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> mean_squared_error
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> r2_score
<span class="token keyword">from</span> math <span class="token keyword">import</span> sqrt
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> metrics
<span class="token comment"># 导入了 sklearn 库中的评估指标，如均方误差（Mean Squared Error, MSE）、R平方值（R-squared）以及其他评估指标。</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> roc_auc_score<span class="token punctuation">,</span> accuracy_score
<span class="token comment"># 导入了 sklearn 库中的 ROC AUC 和准确率评估指标。</span>
<span class="token comment"># 我们很多时候，需要用到解析命令行参数的程序，例如在终端窗口输入(深度学习)训练的参数和选项。</span>
parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">'Deep Knowledge tracing model'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-epsilon'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Epsilon value for Adam Optimizer'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-l2_lambda'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Lambda for l2 loss'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-learning_rate'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Learning rate'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-max_grad_norm'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Clip gradients to this norm'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-keep_prob'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Keep probability for dropout'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-hidden_layer_num'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'The number of hidden layers'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-hidden_size'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'The number of hidden nodes'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-evaluation_interval'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Evalutaion and print result every x epochs'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-batch_size'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Batch size for training'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-epochs'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Number of epochs to train'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-allow_soft_placement'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">bool</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Allow device soft device placement'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-log_device_placement'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">bool</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Log placement ofops on devices'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-train_data_path'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'data/length/n_700/result_train.csv'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Path to the training dataset'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-test_data_path'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'data/length/n_700/result_val.csv'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Path to the testing dataset'</span><span class="token punctuation">)</span>
<span class="token comment"># 定义了一系列命令行参数，包括 epsilon 值、L2 正则化系数、学习率、梯度裁剪阈值、丢弃率、隐藏层数量、隐藏节点数量、评估间隔、批大小、迭代次数、数据集路径等。</span>
args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 解析命令行参数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span>
<span class="token comment"># 将信息输出到标准错误流的好处在于，它可以与标准输出流分开，这意味着即使程序的标准输出被重定向到文件或管道中，错误信息仍然会显示在控制台上。这有助于用户更容易地注意到可能导致程序出错或异常的问题。在这个特定的情况下，当程序执行时，它会将 args 对象的值输出到标准错误流，这样在程序出现错误时，用户就可以看到程序的参数配置，有助于调试和定位问题。</span>
<span class="token keyword">def</span> <span class="token function">add_gradient_noise</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> stddev<span class="token operator">=</span><span class="token number">1e-3</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#没用到</span>
    <span class="token comment"># 添加梯度噪声的函数，用于防止梯度爆炸。</span>
    <span class="token triple-quoted-string string">"""
    Adds gradient noise as described in http://arxiv.org/abs/1511.06807 [2].
    The input Tensor `t` should be a gradient.
    The output will be `t` + gaussian noise.
    0.001 was said to be a good and fixed value for memory networks [2].
    """</span>
    <span class="token comment"># t是梯度张量</span>
    m <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>t<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    stddev <span class="token operator">=</span> torch<span class="token punctuation">.</span>full<span class="token punctuation">(</span>t<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stddev<span class="token punctuation">)</span>
    <span class="token comment"># 均值为m，方差为stddev</span>
    gn <span class="token operator">=</span> torch<span class="token punctuation">.</span>normal<span class="token punctuation">(</span>mean<span class="token operator">=</span>m<span class="token punctuation">,</span> std<span class="token operator">=</span>stddev<span class="token punctuation">)</span>
    <span class="token keyword">return</span> torch<span class="token punctuation">.</span>add<span class="token punctuation">(</span>t<span class="token punctuation">,</span> gn<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">compute_acc</span><span class="token punctuation">(</span>all_target<span class="token punctuation">,</span> all_pred<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># all_pred = np.concatenate(pred_list, axis=0)</span>
    <span class="token comment">#将 pred_list 中的所有元素按照指定的轴(axis)进行连接，生成一个新的 NumPy 数组 all_pred。    np.concatenate() 函数用于将数组沿着指定的轴连接起来。在这个例子中，axis=0 表示沿着第一个轴（通常是行） 进行连接，因此将 pred_list 中的所有数组按行连接起来，生成一个新的数组。</span>
    <span class="token comment"># all_target = np.concatenate(target_list, axis=0)</span>
    all_pred <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>all_pred<span class="token punctuation">)</span>
    <span class="token comment"># 概率分析，预测值>0.5就预测会做对，&lt;0.5就预测会做错</span>
    all_pred<span class="token punctuation">[</span>all_pred <span class="token operator">></span> <span class="token number">0.5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1.0</span>
    all_pred<span class="token punctuation">[</span>all_pred <span class="token operator">&lt;=</span> <span class="token number">0.5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.0</span>
    all_target <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>all_target<span class="token punctuation">)</span>
    <span class="token keyword">return</span> accuracy_score<span class="token punctuation">(</span>all_target<span class="token punctuation">,</span> all_pred<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">repackage_hidden</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Wraps hidden states in new Tensors, to detach them from their history."""</span>
    <span class="token comment"># 如果A网络的输出被喂给B网络作为输入，如果我们希望在梯度反传的时候只更新B中参数的值，</span>
    <span class="token comment"># 而不更新A中的参数值，这时候就可以使用detach()</span>
    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> h<span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span>repackage_hidden<span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token keyword">for</span> v <span class="token keyword">in</span> h<span class="token punctuation">)</span>  <span class="token comment"># 这个应该是h和c同在的时候， 就需要分开来进行摘下</span>


<span class="token keyword">def</span> <span class="token function">run_epoch</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> optimizer<span class="token punctuation">,</span> students<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> num_steps<span class="token punctuation">,</span> num_skills<span class="token punctuation">,</span> training<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> epoch<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Runs the model on the given data."""</span>

    <span class="token comment"># lr = args.learning_rate  # learning rate</span>
    total_loss <span class="token operator">=</span> <span class="token number">0</span>
    input_size <span class="token operator">=</span> num_skills <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token comment"># start_time = time.time()</span>
    index <span class="token operator">=</span> <span class="token number">0</span>
    actual_labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 真实值</span>
    pred_labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 预测值</span>
    hidden <span class="token operator">=</span> m<span class="token punctuation">.</span>init_hidden<span class="token punctuation">(</span>batch_size<span class="token punctuation">)</span>
    count <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment"># 计算需要进行多少次batch</span>
    batch_num <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>students<span class="token punctuation">)</span> <span class="token operator">//</span> batch_size
    <span class="token comment"># 最后一组的学生数量可能不到batch_size的大小，用小于号防止越界</span>
    all_loss<span class="token punctuation">,</span> all_auc<span class="token punctuation">,</span> all_acc<span class="token punctuation">,</span> all_rmse<span class="token punctuation">,</span> all_r2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">while</span> index<span class="token operator">+</span>batch_size <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>students<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> num_steps<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 比如32*128</span>
        target_id<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        target_correctness <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment"># 对每一组batch进行操作</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 可以看作是锁定每个3元组</span>
            student <span class="token operator">=</span> students<span class="token punctuation">[</span>index<span class="token operator">+</span>i<span class="token punctuation">]</span>
            <span class="token comment"># 每个3元组的第二行-回答的技能编号</span>
            problem_ids <span class="token operator">=</span> student<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token comment"># 每个3元组的第三行-回答的正误</span>
            correctness <span class="token operator">=</span> student<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
            <span class="token comment"># a = torch.range(1, 6) a的tensor中是存在6的，也就是右区间是闭的</span>
            <span class="token comment"># 每一个学生</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>problem_ids<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                problem_id <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>problem_ids<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token comment"># label_index = 0</span>
                <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span>correctness<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    label_index <span class="token operator">=</span> problem_id
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    label_index <span class="token operator">=</span> problem_id <span class="token operator">+</span> num_skills
                x<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> label_index
              <span class="token comment"># 问题编号是通过某种方式编码的标识符。在这段代码中，根据问题或技能的正确性，将其编号存储到 x 数组中。如果学生回答的问题或技能是正确的，则直接使用问题或技能的编号；如果是错误的，则使用问题或技能的编号加上技能数量（即 problem_id + num_skills）。这样的编码方式可能用于区分学生正确回答和错误回答的情况。</span>
            target_id<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token operator">*</span>num_steps<span class="token operator">*</span>num_skills<span class="token operator">+</span>j<span class="token operator">*</span>num_skills<span class="token operator">+</span><span class="token builtin">int</span><span class="token punctuation">(</span>problem_ids<span class="token punctuation">[</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">#这行代码用于构建目标ID列表 target_id 的一部分。在一个特定的序列预测问题中，通常会有一个目标（或标签）与每个输入相对应，以便模型进行预测和训练。具体来说，这行代码的作用是将当前问题的目标 ID 添加到 target_id 列表中。假设 i 表示当前样本（学生）的索引，j 表示当前问题在学生答题序列中的位置。在这个问题中，i * num_steps * num_skills 用于定位到当前学生在目标 ID 列表中的起始位置，而 j * num_skills 用于定位到当前问题对应的起始位置。然后，int(problem_ids[j + 1]) 表示当前问题的下一个问题的编号（或者可以理解为当前问题的答案），通过加上这个编号就可以得到当前问题的目标 ID。这个过程是为了构建训练过程中的目标数据，以便在训练模型时使用。目标 ID 是模型在训练时需要预测的真实值，模型会根据输入数据预测这些目标值，然后通过计算预测值与真实值之间的损失来进行参数更新。   </span>
                target_correctness<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>correctness<span class="token punctuation">[</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                actual_labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>correctness<span class="token punctuation">[</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 在这段代码中，x 是一个用于存储问题或技能编号的二维 NumPy 数组，用于构建模型的输入数据。具体来说，x 的形状是 (batch_size, num_steps)，其中 batch_size 是批处理大小，num_steps 是问题或技能序列的长度。</span>
        <span class="token comment"># 每一行代表一个学生的问题或技能序列，每一列代表序列中的一个时间步（即学生回答问题的顺序）。数组中的每个元素表示学生在特定时间步回答的问题或技能的编号。</span>
        <span class="token comment"># 在这段代码中，通过循环遍历每个学生，以及每个学生回答的问题或技能，并将问题或技能的编号填充到 x 数组中的相应位置。对于每个学生的每个问题或技能，将其编号填充到数组的对应位置，以构建表示问题或技能序列的二维数组。</span>
        <span class="token comment"># x 数组用于存储学生的问题或技能序列的编号，是模型的输入数据之一，用于训练和测试深度知识追踪模型。       </span>
        <span class="token comment"># index指向下一组batch</span>
        index <span class="token operator">+=</span> batch_size
        count <span class="token operator">+=</span> <span class="token number">1</span>
        target_id <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>target_id<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>int64<span class="token punctuation">)</span>
        target_correctness <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>target_correctness<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">)</span>

        <span class="token comment"># One Hot encoding input data [batch_size, num_steps, input_size]</span>
        <span class="token comment"># x代表每个学生回答每个问题的正误情况</span>
        x <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>x<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>int64<span class="token punctuation">)</span>
        <span class="token comment"># unsqueeze:扩充数据维度，在0起的指定位置N加上维数为一的维度，这里的x本来是两维，现在变为3维</span>
        x <span class="token operator">=</span> torch<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        input_data <span class="token operator">=</span> torch<span class="token punctuation">.</span>FloatTensor<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> num_steps<span class="token punctuation">,</span> input_size<span class="token punctuation">)</span>
        input_data<span class="token punctuation">.</span>zero_<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 在input_data的第三维找到x中所记录的位置，并将之修改为1,one-hot编码转换</span>
        input_data<span class="token punctuation">.</span>scatter_<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> training<span class="token punctuation">:</span>
            <span class="token comment">#在训练模式下，模型的目标是通过学习从输入到输出的映射关系，最小化损失函数，使得模型的预测              尽可能接近真实值。</span>
            <span class="token comment">#为了实现这一目标，我们通过计算损失函数来衡量模型预测与真实值之间的差异，并使用反向传播算              法来计算损失函数对模型参数的梯度.然后，利用这些梯度来更新模型的参数，以便不断优化模型，使              其在训练数据上的表现逐渐提升。</span>
            hidden <span class="token operator">=</span> repackage_hidden<span class="token punctuation">(</span>hidden<span class="token punctuation">)</span>
            <span class="token comment"># 将梯度初始化为零（因为一个batch的loss关于weight的导数是所有sample的loss关于weight的导数的累加和）</span>
            optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
            output<span class="token punctuation">,</span> hidden <span class="token operator">=</span> m<span class="token punctuation">(</span>input_data<span class="token punctuation">,</span> hidden<span class="token punctuation">)</span>
            <span class="token comment"># Get prediction results from output [batch_size, num_steps, num_skills]</span>
            <span class="token comment"># 将output转成1维</span>
            output <span class="token operator">=</span> output<span class="token punctuation">.</span>contiguous<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token comment"># 从output的特定位置取值，具体位置由target_id给出</span>
            logits <span class="token operator">=</span> torch<span class="token punctuation">.</span>gather<span class="token punctuation">(</span>output<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> target_id<span class="token punctuation">)</span>
            <span class="token comment"># preds 使用sigmod函数</span>
            preds <span class="token operator">=</span> torch<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span>logits<span class="token punctuation">)</span>
            <span class="token comment"># 在浮点数结果上使用 .item() 函数可以提高显示精度</span>
            <span class="token keyword">for</span> p <span class="token keyword">in</span> preds<span class="token punctuation">:</span>
                pred_labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span>p<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment"># criterion = nn.CrossEntropyLoss()</span>
            <span class="token comment"># sigmoid+BCEloss</span>
            <span class="token comment"># softmax+CrossEntropyLoss</span>
            criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>BCEWithLogitsLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>
            loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>logits<span class="token punctuation">,</span> target_correctness<span class="token punctuation">)</span>
            loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># `clip_grad_norm` helps prevent the exploding gradient problem in RNNs / LSTMs.</span>
            <span class="token comment"># max_norm越小，裁剪的梯度越大，得到的梯度就越小，防止梯度爆炸的效果越明显</span>
            torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>clip_grad_norm_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> args<span class="token punctuation">.</span>max_grad_norm<span class="token punctuation">)</span>
            optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># total_loss += loss.item()</span>
            all_loss<span class="token punctuation">.</span>append<span class="token punctuation">(</span>loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 后边的内容不进行计算图的构建,测试评估模型性能</span>
            <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                m<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                output<span class="token punctuation">,</span> hidden <span class="token operator">=</span> m<span class="token punctuation">(</span>input_data<span class="token punctuation">,</span> hidden<span class="token punctuation">)</span>
                output <span class="token operator">=</span> output<span class="token punctuation">.</span>contiguous<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
                logits <span class="token operator">=</span> torch<span class="token punctuation">.</span>gather<span class="token punctuation">(</span>output<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> target_id<span class="token punctuation">)</span>
                <span class="token comment"># preds</span>
                preds <span class="token operator">=</span> torch<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span>logits<span class="token punctuation">)</span>
                <span class="token comment"># pred_labels用于后面计算rmse</span>
                <span class="token keyword">for</span> p <span class="token keyword">in</span> preds<span class="token punctuation">:</span>
                    pred_labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span>p<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment"># criterion = nn.CrossEntropyLoss()</span>
                criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>BCEWithLogitsLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>
                loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>logits<span class="token punctuation">,</span> target_correctness<span class="token punctuation">)</span>
                <span class="token comment"># total_loss += loss.item()</span>
                all_loss<span class="token punctuation">.</span>append<span class="token punctuation">(</span>loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                hidden <span class="token operator">=</span> repackage_hidden<span class="token punctuation">(</span>hidden<span class="token punctuation">)</span>

        <span class="token comment"># print pred_labels</span>
        rmse <span class="token operator">=</span> sqrt<span class="token punctuation">(</span>mean_squared_error<span class="token punctuation">(</span>actual_labels<span class="token punctuation">,</span> pred_labels<span class="token punctuation">)</span><span class="token punctuation">)</span>
        all_rmse<span class="token punctuation">.</span>append<span class="token punctuation">(</span>rmse<span class="token punctuation">)</span>
        <span class="token comment"># 计算ROC</span>
        fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">,</span> thresholds <span class="token operator">=</span> metrics<span class="token punctuation">.</span>roc_curve<span class="token punctuation">(</span>actual_labels<span class="token punctuation">,</span> pred_labels<span class="token punctuation">,</span> pos_label<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token comment"># 计算AUC</span>
        auc <span class="token operator">=</span> metrics<span class="token punctuation">.</span>auc<span class="token punctuation">(</span>fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">)</span>
        all_auc<span class="token punctuation">.</span>append<span class="token punctuation">(</span>auc<span class="token punctuation">)</span>
        <span class="token comment"># count指当前在第几个batch的计算，batch_num指的是一共有几个batch</span>
        <span class="token comment"># print("Epoch: &#123;&#125;,  Batch &#123;&#125;/&#123;&#125; AUC: &#123;&#125;".format(epoch, count, batch_num, auc))</span>
        <span class="token comment"># calculate r^2</span>
        r2 <span class="token operator">=</span> r2_score<span class="token punctuation">(</span>actual_labels<span class="token punctuation">,</span> pred_labels<span class="token punctuation">)</span>
        all_r2<span class="token punctuation">.</span>append<span class="token punctuation">(</span>r2<span class="token punctuation">)</span>
        acc <span class="token operator">=</span> compute_acc<span class="token punctuation">(</span>actual_labels<span class="token punctuation">,</span> pred_labels<span class="token punctuation">)</span>
        all_acc<span class="token punctuation">.</span>append<span class="token punctuation">(</span>acc<span class="token punctuation">)</span>
    loss <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>all_loss<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>all_loss<span class="token punctuation">)</span>
    auc <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>all_auc<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>all_auc<span class="token punctuation">)</span>
    acc <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>all_acc<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>all_acc<span class="token punctuation">)</span>
    rmse <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>all_rmse<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>all_rmse<span class="token punctuation">)</span>
    r2 <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>all_r2<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>all_r2<span class="token punctuation">)</span>
    <span class="token comment"># return rmse, auc, r2, acc</span>
    <span class="token keyword">return</span> loss<span class="token punctuation">,</span> auc<span class="token punctuation">,</span> acc<span class="token punctuation">,</span> rmse<span class="token punctuation">,</span> r2

	
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    train_data_path <span class="token operator">=</span> args<span class="token punctuation">.</span>train_data_path
    test_data_path <span class="token operator">=</span> args<span class="token punctuation">.</span>test_data_path
    batch_size <span class="token operator">=</span> args<span class="token punctuation">.</span>batch_size
    train_students<span class="token punctuation">,</span> train_max_num_problems<span class="token punctuation">,</span> train_max_skill_num <span class="token operator">=</span> load_data<span class="token punctuation">(</span>train_data_path<span class="token punctuation">)</span>
    num_steps <span class="token operator">=</span> train_max_num_problems
    num_skills <span class="token operator">=</span> train_max_skill_num
    num_layers <span class="token operator">=</span> <span class="token number">1</span>
    test_students<span class="token punctuation">,</span> test_max_num_problems<span class="token punctuation">,</span> test_max_skill_num <span class="token operator">=</span>load_data<span class="token punctuation">(</span>test_data_path<span class="token punctuation">)</span>
    <span class="token comment"># num_skills*2是为了包含答对答错的信息</span>
    model <span class="token operator">=</span> DeepKnowledgeTracing<span class="token punctuation">(</span><span class="token string">'LSTM'</span><span class="token punctuation">,</span> num_skills<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">,</span> args<span class="token punctuation">.</span>hidden_size<span class="token punctuation">,</span> num_skills<span class="token punctuation">,</span> num_layers<span class="token punctuation">)</span>
    optimizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>args<span class="token punctuation">.</span>learning_rate<span class="token punctuation">,</span> eps<span class="token operator">=</span>args<span class="token punctuation">.</span>epsilon<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        loss<span class="token punctuation">,</span> auc<span class="token punctuation">,</span> acc<span class="token punctuation">,</span> rmse<span class="token punctuation">,</span> r2 <span class="token operator">=</span> run_epoch<span class="token punctuation">(</span>model<span class="token punctuation">,</span> optimizer<span class="token punctuation">,</span>  train_students<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> num_steps<span class="token punctuation">,</span> num_skills<span class="token punctuation">,</span> epoch<span class="token operator">=</span>i<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Training epoch </span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">: loss </span><span class="token interpolation"><span class="token punctuation">&#123;</span>loss<span class="token punctuation">:</span><span class="token format-spec">.5f</span><span class="token punctuation">&#125;</span></span><span class="token string">, auc </span><span class="token interpolation"><span class="token punctuation">&#123;</span>auc<span class="token punctuation">:</span><span class="token format-spec">.5f</span><span class="token punctuation">&#125;</span></span><span class="token string">, acc </span><span class="token interpolation"><span class="token punctuation">&#123;</span>acc<span class="token punctuation">:</span><span class="token format-spec">.5f</span><span class="token punctuation">&#125;</span></span><span class="token string">, rmse </span><span class="token interpolation"><span class="token punctuation">&#123;</span>rmse<span class="token punctuation">:</span><span class="token format-spec">.5f</span><span class="token punctuation">&#125;</span></span><span class="token string">, r2 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>r2<span class="token punctuation">:</span><span class="token format-spec">.5f</span><span class="token punctuation">&#125;</span></span><span class="token string">."</span></span><span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span>
        <span class="token comment"># Testing</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> args<span class="token punctuation">.</span>evaluation_interval <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            ii <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">//</span> args<span class="token punctuation">.</span>evaluation_interval
            loss<span class="token punctuation">,</span> auc<span class="token punctuation">,</span> acc<span class="token punctuation">,</span> rmse<span class="token punctuation">,</span> r2 <span class="token operator">=</span> run_epoch<span class="token punctuation">(</span>
                model<span class="token punctuation">,</span> optimizer<span class="token punctuation">,</span> test_students<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> num_steps<span class="token punctuation">,</span> num_skills<span class="token punctuation">,</span> training<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Testing epoch </span><span class="token interpolation"><span class="token punctuation">&#123;</span>ii<span class="token punctuation">&#125;</span></span><span class="token string">: loss </span><span class="token interpolation"><span class="token punctuation">&#123;</span>loss<span class="token punctuation">:</span><span class="token format-spec">.5f</span><span class="token punctuation">&#125;</span></span><span class="token string">, auc </span><span class="token interpolation"><span class="token punctuation">&#123;</span>auc<span class="token punctuation">:</span><span class="token format-spec">.5f</span><span class="token punctuation">&#125;</span></span><span class="token string">, acc </span><span class="token interpolation"><span class="token punctuation">&#123;</span>acc<span class="token punctuation">:</span><span class="token format-spec">.5f</span><span class="token punctuation">&#125;</span></span><span class="token string">, rmse </span><span class="token interpolation"><span class="token punctuation">&#123;</span>rmse<span class="token punctuation">:</span><span class="token format-spec">.5f</span><span class="token punctuation">&#125;</span></span><span class="token string">, r2 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>r2<span class="token punctuation">:</span><span class="token format-spec">.5f</span><span class="token punctuation">&#125;</span></span><span class="token string">."</span></span><span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="数据形式"><a href="#数据形式" class="headerlink" title="数据形式"></a>数据形式</h2><p>(题目信息)</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"RECORDS"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
        <span class="token property">"AnswerId"</span><span class="token operator">:</span> <span class="token string">"690384"</span><span class="token punctuation">,</span>
        <span class="token property">"QuestionId"</span><span class="token operator">:</span> <span class="token string">"440"</span><span class="token punctuation">,</span>
        <span class="token property">"UserId"</span><span class="token operator">:</span> <span class="token string">"0"</span><span class="token punctuation">,</span>
        <span class="token property">"CorrectAnswer"</span><span class="token operator">:</span> <span class="token string">"2"</span><span class="token punctuation">,</span>
        <span class="token property">"AnswerValue"</span><span class="token operator">:</span> <span class="token string">"2"</span><span class="token punctuation">,</span>
        <span class="token property">"IsCorrect"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
        <span class="token property">"Context"</span><span class="token operator">:</span> <span class="token string">"What is the name of the mathematical instrument used to construct circles?"</span><span class="token punctuation">,</span>
        <span class="token property">"Option_A"</span><span class="token operator">:</span> <span class="token string">"Callipers"</span><span class="token punctuation">,</span>
        <span class="token property">"Option_B"</span><span class="token operator">:</span> <span class="token string">"Compass"</span><span class="token punctuation">,</span>
        <span class="token property">"Option_C"</span><span class="token operator">:</span> <span class="token string">"Protractor"</span><span class="token punctuation">,</span>
        <span class="token property">"Option_D"</span><span class="token operator">:</span> <span class="token string">"Slide rule"</span><span class="token punctuation">,</span>
        <span class="token property">"GroupId"</span><span class="token operator">:</span> <span class="token string">"216"</span><span class="token punctuation">,</span>
        <span class="token property">"QuizId"</span><span class="token operator">:</span> <span class="token string">"85"</span><span class="token punctuation">,</span>
        <span class="token property">"SubjectId"</span><span class="token operator">:</span> <span class="token string">"[3, 71, 83, 190]"</span><span class="token punctuation">,</span>
        <span class="token property">"DateAnswered"</span><span class="token operator">:</span> <span class="token string">"2020-04-17 13:38:00.000"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
        <span class="token property">"AnswerId"</span><span class="token operator">:</span> <span class="token string">"1427450"</span><span class="token punctuation">,</span>
        <span class="token property">"QuestionId"</span><span class="token operator">:</span> <span class="token string">"814"</span><span class="token punctuation">,</span>
        <span class="token property">"UserId"</span><span class="token operator">:</span> <span class="token string">"0"</span><span class="token punctuation">,</span>
        <span class="token property">"CorrectAnswer"</span><span class="token operator">:</span> <span class="token string">"4"</span><span class="token punctuation">,</span>
        <span class="token property">"AnswerValue"</span><span class="token operator">:</span> <span class="token string">"4"</span><span class="token punctuation">,</span>
        <span class="token property">"IsCorrect"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
        <span class="token property">"Context"</span><span class="token operator">:</span> <span class="token string">"Which of the following diagrams shows a diameter?"</span><span class="token punctuation">,</span>
        <span class="token property">"Option_A"</span><span class="token operator">:</span> <span class="token string">"pic814_1_0"</span><span class="token punctuation">,</span>
        <span class="token property">"Option_B"</span><span class="token operator">:</span> <span class="token string">"pic814_1_1"</span><span class="token punctuation">,</span>
        <span class="token property">"Option_C"</span><span class="token operator">:</span> <span class="token string">"pic814_1_2"</span><span class="token punctuation">,</span>
        <span class="token property">"Option_D"</span><span class="token operator">:</span> <span class="token string">"pic814_1_3"</span><span class="token punctuation">,</span>
        <span class="token property">"GroupId"</span><span class="token operator">:</span> <span class="token string">"216"</span><span class="token punctuation">,</span>
        <span class="token property">"QuizId"</span><span class="token operator">:</span> <span class="token string">"85"</span><span class="token punctuation">,</span>
        <span class="token property">"SubjectId"</span><span class="token operator">:</span> <span class="token string">"[3, 71, 77, 184]"</span><span class="token punctuation">,</span>
        <span class="token property">"DateAnswered"</span><span class="token operator">:</span> <span class="token string">"2020-04-17 13:39:00.000"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    ...
    ...
    ...
    <span class="token punctuation">&#123;</span>
        <span class="token property">"AnswerId"</span><span class="token operator">:</span> <span class="token string">"860053"</span><span class="token punctuation">,</span>
        <span class="token property">"QuestionId"</span><span class="token operator">:</span> <span class="token string">"933"</span><span class="token punctuation">,</span>
        <span class="token property">"UserId"</span><span class="token operator">:</span> <span class="token string">"0"</span><span class="token punctuation">,</span>
        <span class="token property">"CorrectAnswer"</span><span class="token operator">:</span> <span class="token string">"2"</span><span class="token punctuation">,</span>
        <span class="token property">"AnswerValue"</span><span class="token operator">:</span> <span class="token string">"2"</span><span class="token punctuation">,</span>
        <span class="token property">"IsCorrect"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
        <span class="token property">"Context"</span><span class="token operator">:</span> <span class="token string">"Jo and Paul are arguing about the red line drawn on the circle to the right. Jo says it is a chord. Paul says it is an arc. Who is correct? pic933_0"</span><span class="token punctuation">,</span>
        <span class="token property">"Option_A"</span><span class="token operator">:</span> <span class="token string">"Only Jo"</span><span class="token punctuation">,</span>
        <span class="token property">"Option_B"</span><span class="token operator">:</span> <span class="token string">"Only Paul"</span><span class="token punctuation">,</span>
        <span class="token property">"Option_C"</span><span class="token operator">:</span> <span class="token string">"Both Jo and Paul"</span><span class="token punctuation">,</span>
        <span class="token property">"Option_D"</span><span class="token operator">:</span> <span class="token string">"Neither is correct"</span><span class="token punctuation">,</span>
        <span class="token property">"GroupId"</span><span class="token operator">:</span> <span class="token string">"216"</span><span class="token punctuation">,</span>
        <span class="token property">"QuizId"</span><span class="token operator">:</span> <span class="token string">"85"</span><span class="token punctuation">,</span>
        <span class="token property">"SubjectId"</span><span class="token operator">:</span> <span class="token string">"[3, 71, 77, 184]"</span><span class="token punctuation">,</span>
        <span class="token property">"DateAnswered"</span><span class="token operator">:</span> <span class="token string">"2020-04-17 13:40:00.000"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>（学生答题情况）</p>
<pre class="line-numbers language-none"><code class="language-none">27
13,16,13,14,16,14,16,19,19,19,19,10,13,120,120,120,10,13,120,120,120,10,13,10,13,10,13
0,0,0,0,1,0,1,1,1,1,1,0,0,0,1,0,0,0,1,0,1,1,1,1,1,1,1
26
56,78,6,6,6,6,6,2,2,11,11,11,11,11,11,30,35,30,30,30,30,35,11,11,70,70
1,1,0,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,0,1,1,1,1,1,0,0
46
45,45,45,45,45,45,45,45,89,89,89,89,89,89,89,45,45,45,45,45,45,89,89,89,89,89,89,89,89,89,89,89,89,89,89,89,89,89,89,89,89,89,89,89,89,89
0,0,0,0,1,1,0,1,0,0,0,0,1,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,1,0,1,1,0,0
20
74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74
0,0,0,1,0,1,0,0,0,1,1,1,0,1,0,1,1,0,0,1
20
19,19,19,19,19,120,120,120,19,120,120,120,19,19,19,19,19,19,19,19
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
85
4,11,56,43,2,2,81,81,81,81,71,71,71,71,71,73,56,78,2,46,45,119,119,119,119,119,46,45,46,45,46,45,46,46,45,71,71,71,71,19,19,19,17,119,119,119,18,17,119,119,119,17,119,119,18,17,19,119,19,10,19,119,119,19,19,119,119,119,119,119,119,119,119,119,119,119,119,119,119,119,119,119,119,119,119
1,1,1,1,1,1,0,1,1,1,0,0,0,0,0,1,1,1,1,0,0,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,0,0,1,1,1,1,0,0,0,0,0,1,1,0,0,0,1,0,0,0,0,0,0,1,0,1
16
0,14,0,14,0,14,0,14,0,14,0,14,0,16,0,14
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
5
33,38,38,38,38
1,1,1,0,1
...
...
...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="感谢周老师和子威师姐！"><a href="#感谢周老师和子威师姐！" class="headerlink" title="感谢周老师和子威师姐！"></a>感谢周老师和子威师姐！</h3>
                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">chris2ease</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://chris2ease.github.io/2024/03/18/deepknowledgetracing/">https://chris2ease.github.io/2024/03/18/deepknowledgetracing/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">chris2ease</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">
                                    <span class="chip bg-color">人工智能</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2024/03/23/bert/">
                    <div class="card-image">
                        
                        <img src="https://chris2ease-1324337338.cos.ap-shanghai.myqcloud.com/ioq.jpg" class="responsive-img" alt="Bert">
                        
                        <span class="card-title">Bert</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            bert模型的基本概念
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2024-03-23
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/DeepLearning/" class="post-category">
                                    DeepLearning
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">
                        <span class="chip bg-color">人工智能</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2024/03/09/recurrent-neural-network-rnn/">
                    <div class="card-image">
                        
                        <img src="https://chris2ease-1324337338.cos.ap-shanghai.myqcloud.com/ioq.jpg" class="responsive-img" alt="Recurrent-Neural-Network(RNN)">
                        
                        <span class="card-title">Recurrent-Neural-Network(RNN)</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            RNN的基本概念
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2024-03-09
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/DeepLearning/" class="post-category">
                                    DeepLearning
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">
                        <span class="chip bg-color">人工智能</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="9495473687"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2025</span>
            
            <a href="/about" target="_blank">chris2ease</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/chris2ease" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:2930459048@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2930459048" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2930459048" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="/libs/background/canvas-nest.js"></script>
    

    
    
    <script type="text/javascript" size="150" alpha='0.6'
        zIndex="-1" src="/libs/background/ribbon-refresh.min.js" async="async"></script>
    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
